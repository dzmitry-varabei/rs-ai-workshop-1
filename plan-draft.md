–Ø –≤–æ–∑—å–º—É **Supabase (Postgres)** –∏ —Å—Ä–∞–∑—É –∑–∞–ª–æ–∂—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö –∏ —Å–ª–æ–∏—Å—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –±—ã–ª–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è, –ø—Ä–∏–º–µ—Ä—ã, –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –∏ —Ç.–¥.

–ù–∏–∂–µ:

1. –ü–æ—á–µ–º—É Supabase –∏ –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.
2. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö, –∑–∞—Ç–æ—á–µ–Ω–Ω–∞—è –ø–æ–¥ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å (–≤ —Ç.—á. –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ).
3. –ö–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —à–∞–≥–∞–º –∏ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–µ PR.
4. –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
5. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∏ `AGENTS.md`, `docs/*.md`, `CONTRIBUTING.md` –∏ PR‚Äë—Ç–µ–º–ø–ª–µ–π—Ç–∞.

–í—Å—ë –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–π –≤–æ—Ä–∫—à–æ–ø-–ø–ª–∞–Ω (web‚Äë–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ + –±–æ—Ç —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–º –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ 3000 —Å–ª–æ–≤) .

---

## 1. –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—á–µ–º—É Supabase

–ù–∞–º –Ω—É–∂–Ω–æ:

* –æ–±—â–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è **web‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –∏ **Telegram‚Äë–±–æ—Ç–∞**;
* –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–ª–æ–≤–æ, –ø—Ä–æ–≥—Ä–µ—Å—Å, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è;
* –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å ‚úö1 —Ç–∞–±–ª–∏—Ü–∞ / ‚úö1 –ø–æ–ª–µ –±–µ–∑ –ø–µ—Ä–µ–¥–µ–ª–∫–∏ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞;
* –ø—Ä–∏–≤—ã—á–Ω—ã–π SQL –∏ –º–∏–≥—Ä–∞—Ü–∏–∏.

Supabase = Postgres + Auth + JS SDK. –≠—Ç–æ –ª–æ–≥–∏—á–Ω–æ –¥–ª—è ¬´—Ä–µ–∞–ª—å–Ω–æ–π¬ª —Å–∏—Å—Ç–µ–º—ã, –∞ –Ω–µ –¥–µ–º–∫–∏: –º–æ–∂–Ω–æ —Ä–∞—Å—Ç–∏ –≤—à–∏—Ä—å, –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–ª–æ–∏:

* **Domain** (`packages/domain`)
  –ß–∏—Å—Ç—ã–µ TS‚Äë—Ç–∏–ø—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:

  * `Word`, `Pronunciation`, `QuizSession`, `SrsItem`, `UserSettings`,
  * —Å–µ—Ä–≤–∏—Å—ã: `srsScheduler`, `quizProgress`, —Ç.–ø.
* **Infrastructure** (`packages/infra-supabase`)
  –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ø–æ–≤–µ—Ä—Ö Supabase:

  * `WordRepositorySupabase`,
  * `UserProgressRepositorySupabase`,
  * `SrsRepositorySupabase`, –∏ —Ç.–ø.
* **Apps**

  * `apps/web` ‚Äî UI –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã (React/Vanilla),
  * `apps/telegram-bot` ‚Äî –±–æ—Ç (Telegraf/grammY).

UI –∏ –±–æ—Ç –∑–Ω–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—è**, –∞ –Ω–µ –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π Supabase.
–î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ ‚Üí –º–µ–Ω—è–µ–º –¥–æ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã + –æ–¥–Ω—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, UI –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ.

---

## 2. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (Supabase) —Å –ø—Ä–∏—Ü–µ–ª–æ–º –Ω–∞ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

–°—Ö–µ–º–∞ –≤ Postgres (—É—Å–ª–æ–≤–Ω–æ `public`):

### 2.1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

```sql
-- auth.users ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Supabase, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë id

create table profiles (
  id uuid primary key references auth.users(id),
  created_at timestamptz default now(),
  telegram_chat_id text unique,
  timezone text,
  daily_word_limit int default 10
);
```

* web‚Äë—é–∑–µ—Ä —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ Supabase Auth (–∞–Ω–æ–Ω–∏–º –∏–ª–∏ email).
* –±–æ—Ç –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `telegram_chat_id`.

### 2.2. –°–ª–æ–≤–∞ –∏ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è

```sql
create table words (
  id uuid primary key default gen_random_uuid(),
  text_en text not null,
  level text,                     -- A1/A2/B1 etc (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
  example_en text,
  example_ru text,
  tags text[] default '{}',       -- —Ç–µ–º—ã/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  extra jsonb default '{}'        -- –∑–∞–ø–∞—Å –ø–æ–¥ –ª—é–±—ã–µ —Ñ–∏—á–∏
);

create table word_pronunciations (
  id uuid primary key default gen_random_uuid(),
  word_id uuid not null references words(id) on delete cascade,
  locale text not null,           -- 'en-US', 'en-GB'
  ipa text,                       -- /b äst/
  audio_url text,                 -- —Å—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ
  source text,                    -- 'forvo', 'tts', ...
  unique(word_id, locale)
);
```

**–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:**

* —Ö–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä—É—é –∑–∞–ø–∏—Å—å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–æ–π –∞–∫—Ü–µ–Ω—Ç ‚Üí –ø—Ä–æ—Å—Ç–æ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ `word_pronunciations`;
* —Ö–æ—á–µ—à—å —Ö—Ä–∞–Ω–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∏–Ω–æ–Ω–∏–º—ã –∏–ª–∏ —Ç–µ–º—ã ‚Üí –¥–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ–ª–µ/JSON –≤ `words` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è API.

### 2.3. –°—Ç–∞—Ç—É—Å —Å–ª–æ–≤–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞)

```sql
create type word_status as enum ('unknown', 'learning', 'known');

create table user_word_state (
  user_id uuid references profiles(id),
  word_id uuid references words(id),
  status word_status not null,
  last_seen_at timestamptz not null default now(),
  seen_count int not null default 1,
  primary key (user_id, word_id)
);
```

* web‚Äë–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ—Å–ª–µ —Å–≤–∞–π–ø–∞ –ø–∏—à–µ—Ç —Å—é–¥–∞ `status` –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç `seen_count`, `last_seen_at`.
* —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å–∫–æ–ª—å–∫–æ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö/–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö), –∏ –∫–∞–∫ –≤—Ö–æ–¥ –¥–ª—è –±–æ—Ç–∞ (–≤ SRS –Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å `unknown`).

### 2.4. SRS (–∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –¥–ª—è –±–æ—Ç–∞)

```sql
create type srs_difficulty as enum ('hard', 'normal', 'good', 'easy');

create table srs_items (
  user_id uuid references profiles(id),
  word_id uuid references words(id),
  next_review_at timestamptz not null,
  last_review_at timestamptz,
  interval_minutes int not null,
  difficulty_last srs_difficulty,
  review_count int not null default 0,
  active boolean not null default true,
  primary key (user_id, word_id)
);
```

* –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –∑–∞–¥–∞—ë–º –≤ –º–∏–Ω—É—Ç–∞—Ö (10 –º–∏–Ω, 1 –¥–µ–Ω—å, 3 –¥–Ω—è, 7 –¥–Ω–µ–π), –∫–∞–∫ –≤ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º –æ–ø–∏—Å–∞–Ω–∏–∏ .
* –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç–∞ ‚Äî –≤ —á–∏—Å—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—è (—Å–º. `docs/spaced-repetition.md` –Ω–∏–∂–µ).

### 2.5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –õ–æ–≥–∏ —Å–µ—Å—Å–∏–π –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã

–ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è –∫—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å PDF ¬´–∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–≥–æ–Ω¬ª, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

```sql
create table quiz_runs (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references profiles(id),
  started_at timestamptz default now(),
  finished_at timestamptz,
  total_words int,
  known_count int,
  unknown_count int
);

create table quiz_answers (
  id uuid primary key default gen_random_uuid(),
  quiz_run_id uuid references quiz_runs(id) on delete cascade,
  word_id uuid references words(id),
  known boolean not null,
  position int,
  created_at timestamptz default now()
);
```

–ù–æ —ç—Ç–æ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ ¬´v2¬ª ‚Äî –≤ –¥–æ–º–µ–Ω–µ –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å `QuizSession`, –∞ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–µ–π, –∫–æ–≥–¥–∞ –¥–æ–π–¥—ë—Ç–µ.

---

## 3. –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–æ–º–µ–Ω–∞

### 3.1. –û—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π

–í `packages/domain`:

```ts
// word.ts
export type WordId = string & { __brand: 'WordId' };

export interface Pronunciation {
  locale: string;
  ipa?: string;
  audioUrl?: string;
}

export interface Word {
  id: WordId;
  text: string;
  level?: string;
  exampleEn?: string;
  exampleRu?: string;
  tags: string[];
  pronunciations: Pronunciation[]; // <- –¥–æ–±–∞–≤–∏–ª–∏ –∏ –≤—Å—ë
}
```

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤:

```ts
export interface WordRepository {
  getRandomBatch(userId: UserId, limit: number): Promise<Word[]>;
  getByIds(ids: WordId[]): Promise<Word[]>;
}

export interface UserWordStateRepository {
  markKnown(userId: UserId, wordId: WordId): Promise<void>;
  markUnknown(userId: UserId, wordId: WordId): Promise<void>;
  getStats(userId: UserId): Promise<UserWordStats>;
}
```

–í `packages/infra-supabase` ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ**, –≥–¥–µ –º—ã –º–∞–ø–∏–º –ë–î ‚Üí –¥–æ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã:

```ts
export class SupabaseWordRepository implements WordRepository {
  async getRandomBatch(userId: UserId, limit: number): Promise<Word[]> {
    // –∑–∞–ø—Ä–æ—Å –≤ words + left join pronunciations
    // –º–∞–ø–ø–∏–Ω–≥ –≤ Word[]
  }
}
```

–¢–µ–ø–µ—Ä—å:

* –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–ª–µ –≤ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, `example_audio_url`) ‚Üí –ø–æ–ø—Ä–∞–≤–∏–ª–∏ –º–∞–ø–ø–∏–Ω–≥ + –¥–æ–º–µ–Ω–Ω—ã–π —Ç–∏–ø ‚Üí UI –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ —Ä—É—à–∏—Ç—Å—è;
* Telegram‚Äë–±–æ—Ç –≤–æ–æ–±—â–µ –Ω–µ –∑–Ω–∞–µ—Ç –æ Supabase, –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å `WordRepository` –∏ `SrsScheduler`.

---

## 4. –ö–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ —à–∞–≥–∞–º

–¢—É—Ç –¥–≤–∞ —É—Ä–æ–≤–Ω—è: **–ø—Ä–æ—Ü–µ—Å—Å** –∏ **–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ —Ä–µ–ø–æ**.

### 4.1. –ü—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –∑–∞–¥–∞—ë—à—å

–í AGENTS.md –∏ CONTRIBUTING.md –º–æ–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å:

1. **–ú–∞–ª–µ–Ω—å–∫–∏–µ PR:**

   * —Ü–µ–ª–µ–≤–æ–π —Ä–∞–∑–º–µ—Ä: *–¥–æ 300‚Äì400 —Å—Ç—Ä–æ–∫ diff*, –Ω–µ –±–æ–ª—å—à–µ 1‚Äì2 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π;
   * –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–µ ‚Äî —Ä–∞–∑–±–µ–π –∑–∞–¥–∞—á—É –Ω–∞ —á–µ–∫‚Äë–ª–∏—Å—Ç –≤ issue –∏ –¥–µ–ª–∞–π –ø–æ PR –Ω–∞ –ø—É–Ω–∫—Ç.

2. **–í—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –ø–ª–∞–Ω ‚Üí –ø–æ—Ç–æ–º –∫–æ–¥:**

   * –∞–≥–µ–Ω—Ç –æ–±—è–∑–∞–Ω –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ issue/PR:

     > Plan:
     >
     > 1. Update data model (new `word_pronunciations` table, domain types).
     > 2. Implement repository mapping.
     > 3. Expose pronunciation in web UI.
     > 4. Add tests.

3. **PR‚Äë—à–∞–±–ª–æ–Ω —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏:**

   * –≤ PR –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–µ–∫—Ü–∏–∏:

     * `What`,
     * `Why`,
     * `How` (–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–π –ª–æ–≥–∏–∫–∏),
     * `Risks & Trade-offs`.

4. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫ —Ç–µ—Å—Ç–∞–º:**

   * –ª—é–±–∞—è –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ SRS) ‚Äî —Å —é–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç–∞–º–∏;
   * –≤ PR –µ—Å—Ç—å —á–µ–∫–±–æ–∫—Å `- [x] Added/updated tests`.

5. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ:**

   * –Ω–∞ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∞–≥–µ–Ω—Ç –ø–∏—à–µ—Ç `// NOTE: ...` (–Ω–µ ¬´—á—Ç–æ –¥–µ–ª–∞–µ—Ç¬ª, –∞ ¬´–ø–æ—á–µ–º—É —Ç–∞–∫¬ª).

6. **–õ–µ–π–±–ª—ã –∏ —à–∞–≥–∏:**

   * `ai:wip` ‚Äî –∞–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π;
   * `ai:ready-for-review` ‚Äî –º–æ–∂–Ω–æ —Ä–µ–≤—å—é–∏—Ç—å;
   * `ai:needs-clarification` ‚Äî –µ—Å–ª–∏ –∞–≥–µ–Ω—Ç —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è, –æ–Ω –æ–±—è–∑–∞–Ω –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å.

### 4.2. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: —á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–ø–æ

* `AGENTS.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤, –∫—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å (–Ω–∏–∂–µ –¥–∞–º —á–µ—Ä–Ω–æ–≤–∏–∫).
* `.github/pull_request_template.md` ‚Äî –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –∞–≥–µ–Ω—Ç–∞ –æ–±—ä—è—Å–Ω—è—Ç—å –∫–æ–¥.
* `docs/decisions/` ‚Äî –ø–∞–ø–∫–∞ –¥–ª—è –º–∏–Ω–∏‚ÄëADR:

  * `docs/decisions/0001-use-supabase.md` ‚Äî –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ Supabase;
  * –ø–æ –∂–µ–ª–∞–Ω–∏—é –º–æ–∂–Ω–æ –ø—Ä–æ—Å–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ –¥–æ–±–∞–≤–ª—è—Ç—å ADR –Ω–∞ –∫—Ä—É–ø–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
* GitHub Action (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —á—Ç–æ–±—ã:

  * —Ä—É–≥–∞—Ç—å—Å—è, –µ—Å–ª–∏ PR > N —Å—Ç—Ä–æ–∫;
  * –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ –∑–∞–ø–æ–ª–Ω–µ–Ω PR‚Äë—Ç–µ–º–ø–ª–µ–π—Ç.

–¢–∞–∫ —Ç—ã –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—à—å:

* **–∫–∞–∫–æ–π —ç—Ç–∞–ø** —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ—Ç—Å—è (–ø–æ —á–µ–∫‚Äë–ª–∏—Å—Ç—É –∏ –ª–µ–π–±–ª–∞–º);
* **–ø–æ—á–µ–º—É** –∫–æ–¥ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π (ADR + —Å–µ–∫—Ü–∏—è `Why` –≤ PR).

---

## 5. –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```txt
.
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/                 # –í–µ–±‚Äë–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞
‚îÇ   ‚îî‚îÄ‚îÄ telegram-bot/        # Telegram-–±–æ—Ç —Å SRS
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ domain/              # –ß–∏—Å—Ç—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã/—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ infra-supabase/      # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø–æ–≤–µ—Ä—Ö Supabase
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ overview.md
‚îÇ   ‚îú‚îÄ‚îÄ web-app.md
‚îÇ   ‚îú‚îÄ‚îÄ telegram-bot.md
‚îÇ   ‚îú‚îÄ‚îÄ spaced-repetition.md
‚îÇ   ‚îú‚îÄ‚îÄ data-model.md
‚îÇ   ‚îî‚îÄ‚îÄ decisions/
‚îÇ       ‚îî‚îÄ‚îÄ 0001-use-supabase.md (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ supabase/                # —Å—Ö–µ–º–∞ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îî‚îÄ‚îÄ seed/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îî‚îÄ‚îÄ pull_request_template.md
‚îú‚îÄ‚îÄ AGENTS.md
‚îú‚îÄ‚îÄ CONTRIBUTING.md
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ pnpm-workspace.yaml
```

---

## 6. –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ MD‚Äë—Ñ–∞–π–ª–æ–≤ (—É–∂–µ —Å Supabase –∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∞–≥–µ–Ω—Ç–æ–≤)

–ù–∏–∂–µ ‚Äî –≥–æ—Ç–æ–≤—ã–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ—á—Ç–∏ –∫–∞–∫ –µ—Å—Ç—å –∫–ª–∞—Å—Ç—å –≤ —Ä–µ–ø–æ.

---

### `AGENTS.md`

```md
# AGENTS.md

## Who you are

You are an AI developer working on the **English Learning System**:

- a web quiz app to quickly test English vocabulary knowledge;
- a Telegram bot that uses spaced repetition to help users learn unknown words.

You work as a remote teammate with limited context: **you only see this repo**.
Always prefer reading existing docs and code over guessing.

---

## Repository map

- `apps/web`
  - Vocabulary quiz UI (cards, swipe / keyboard / touch).
  - Shows words from the shared dictionary.
  - Updates user word status (`known` / `unknown`) in the database.
  - Exports results to PDF.
- `apps/telegram-bot`
  - Telegram bot that:
    - reads unknown words for a user;
    - schedules reviews using spaced repetition;
    - sends messages with examples and translations (with Telegram spoilers);
    - uses inline buttons to collect difficulty.
- `packages/domain`
  - Pure TypeScript types and business logic:
    - word model, pronunciations, quiz stats, SRS scheduler, etc.
- `packages/infra-supabase`
  - Implementations of domain repositories using Supabase (Postgres).
- `docs/`
  - `overview.md` ‚Äî high-level architecture and use cases.
  - `web-app.md` ‚Äî quiz behaviour and UI details.
  - `telegram-bot.md` ‚Äî bot flows and message formats.
  - `spaced-repetition.md` ‚Äî SRS algorithm.
  - `data-model.md` ‚Äî database schema and relations.
- `supabase/`
  - Database migrations and seed data.

Start with `docs/overview.md`, then read the doc that matches the area you‚Äôre touching.

---

## Tech stack

- Language: **TypeScript** only.
- Package manager: **pnpm**.
- Storage & backend: **Supabase (Postgres + Auth)**.
- Web: React + Vite (or similar).
- Bot: Node.js + Telegraf/grammY, talking to Supabase.
- Linting: ESLint + Prettier.
- Tests: Vitest/Jest.

### Common scripts

From the repo root:

- `pnpm dev:web` ‚Äî start web app dev server.
- `pnpm dev:bot` ‚Äî start Telegram bot in dev mode.
- `pnpm lint` ‚Äî lint all packages.
- `pnpm typecheck` ‚Äî run TypeScript checks.
- `pnpm test` ‚Äî run unit tests.
- `pnpm check` ‚Äî run `lint`, `typecheck`, and `test`.

Always run `pnpm check` before finishing your work.

---

## How to work on issues (step-by-step control)

When you get an issue:

1. **Understand the domain**
   - Read `docs/overview.md`.
   - Read the specific doc: `web-app.md`, `telegram-bot.md`, `spaced-repetition.md`, or `data-model.md`.

2. **Post a short plan before coding**
   - Add a comment to the issue or PR:

     > Plan:
     > 1. Update domain types for X.
     > 2. Update Supabase repository implementation.
     > 3. Update web/bot to use the new field.
     > 4. Add tests and docs.

3. **Work in small steps**
   - Aim for PRs with **‚â§ 300‚Äì400 lines changed**.
   - Each PR should address **1‚Äì2 logical steps** from the issue.
   - If the issue is too big, suggest splitting it.

4. **Keep changes localized**
   - Prefer changing `packages/domain` and `packages/infra-supabase` instead of duplicating logic in apps.
   - For database changes:
     - add/modify migration in `supabase/migrations`;
     - update `docs/data-model.md`;
     - update mapping code in `packages/infra-supabase`.

5. **Explain non-obvious decisions**
   - Use comments like `// NOTE: why this approach is chosen`.
   - In the PR description, fill in the `Why` and `How` sections.

---

## Quality bar

- No TypeScript errors.
- No ESLint errors.
- New logic covered by unit tests.
- Database migrations are included and documented when schema changes.
- Web remains keyboard and touch friendly.
- Telegram bot handles errors gracefully (no crashes on unexpected data).

---

## Git and pull requests

- Use branches: `feature/<issue-number>-short-name` or `fix/<issue-number>-short-name`.
- Commit messages in English, describing what changed.
- Pull requests:
  - link the issue (e.g. `Closes #123`);
  - keep the diff small and focused;
  - fill in the PR template (What / Why / How / Checklist);
  - attach screenshots or bot message examples if UI/UX changed.

---

## If you are unsure

If something is unclear:

1. Re-read the relevant doc in `docs/`.
2. Search the repo for existing patterns.
3. Leave a comment in the issue / PR describing:
   - what is unclear,
   - what options you see,
   - which option you prefer and why.

Do **not** implement complex features without leaving a plan and getting feedback.
```

---

### `docs/overview.md`

```md
# Overview

We are building an ecosystem for learning English vocabulary:

1. A **web quiz app** that shows words from a 3000‚Äëword frequency list and lets the user mark whether they know each word.
2. A **Telegram bot** that uses spaced repetition (SRS) to help the user learn unknown words over time.

Originally the prototype used `localStorage` and sqlite as storage; in this repository we use **Supabase (Postgres)** as the shared backend for both the web app and the bot. :contentReference[oaicite:2]{index=2}

## High-level flow

1. User opens the web quiz.
2. The app shows words one by one (card UI, swipe/keyboard/touch).
3. For each word the user marks:
   - "know" ‚Üí status `known`,
   - "don't know" ‚Üí status `unknown`.
4. The app stores the word status in Supabase.
5. Unknown words are used to create/update SRS items for the Telegram bot.
6. The user links their Telegram account with the web account.
7. The bot sends review messages with examples and translations.
8. The user rates difficulty (4 levels), which adjusts future intervals.

## Main components

- `apps/web` ‚Äî quiz UI, stats, PDF export.
- `apps/telegram-bot` ‚Äî SRS bot.
- `packages/domain` ‚Äî shared business logic.
- `packages/infra-supabase` ‚Äî data access layer.
- `supabase` ‚Äî database schema and migrations.

See also:

- `docs/web-app.md` ‚Äî details of the quiz and stats.
- `docs/telegram-bot.md` ‚Äî bot flows and message formats.
- `docs/spaced-repetition.md` ‚Äî SRS algorithm.
- `docs/data-model.md` ‚Äî tables and relations.
```

---

### `docs/web-app.md`

```md
# Web Quiz App

The web app is a Tinder-like quiz for English words. It helps the user quickly estimate how many of the 3000 most frequent words they know. :contentReference[oaicite:3]{index=3}

## UI behaviour

- The app shows one **card** at a time:
  - front: English word (and optionally pronunciation / IPA later);
  - subtle hint about controls.
- Controls:
  - mouse: drag card left/right;
  - keyboard: left/right arrows;
  - touch: swipe left/right.
- Actions:
  - right ‚Üí "I know this word";
  - left ‚Üí "I don't know this word".
- Animations:
  - smooth slide off screen and next card appearing.

## Data source

- Words are loaded from the shared dictionary in Supabase (`words` table).
- Optional fields (examples, pronunciations, tags) may or may not be present.
- The app should handle missing optional data gracefully.

## Progress and stats

The app shows:

- progress bar: `current index / total words`,
- counters:
  - total seen words,
  - known words,
  - unknown words,
  - knowledge percentage.

Progress is computed from `user_word_state` for the current user.

## Persistence (Supabase)

Instead of storing results in `localStorage`, the app:

- authenticates the user via Supabase (anonymous auth is enough);
- writes status for each word:

  - known ‚Üí `status = 'known'`,
  - unknown ‚Üí `status = 'unknown'`,

  by upserting rows in `user_word_state`.
- optionally creates/updates SRS items for unknown words.

## PDF export

The app supports exporting results as a PDF:

- list of known words,
- list of unknown words,
- date/time of the test,
- optional summary stats.

Implementation detail:

- PDF is generated on the client using a JS library.
- Data for export comes from Supabase (fresh query), not from local state.

## Reset and resume

- **Reset progress** button:
  - shows a confirmation modal;
  - removes all `user_word_state` records for the current user (or marks them as reset).
- **Resume**:
  - when the user returns, the app:
    - fetches `user_word_state`,
    - starts the quiz from the first not-yet-seen word.
```

---

### `docs/telegram-bot.md`

````md
# Telegram Bot

The Telegram bot helps users learn unknown words using spaced repetition.

## Linking accounts

We need to link a web user (Supabase `auth.users`) with a Telegram chat.

Basic flow:

1. User clicks "Connect Telegram bot" in the web app.
2. Backend generates a short code and stores it with `user_id`.
3. User opens the bot and sends the code (or uses a deep link).
4. Bot finds the code, reads `user_id`, and stores `telegram_chat_id` in `profiles`.

After linking, the bot can fetch the user‚Äôs unknown words and SRS items.

## SRS workflow

1. Bot periodically queries SRS items where `next_review_at <= now` for the given user.
2. For each item, the bot loads the corresponding `word` and (optionally) `pronunciation` and examples.
3. Bot sends a message:

   ```text
   I'd like some coffee. I need the **boost**.

   ||–Ø –±—ã –≤—ã–ø–∏–ª –∫–æ—Ñ–µ. –ú–Ω–µ –Ω—É–∂–µ–Ω –∑–∞—Ä—è–¥ –±–æ–¥—Ä–æ—Å—Ç–∏.||  (spoiler)
````

with inline buttons:

* üò∞ Hard
* ü§î Normal
* üëç Good
* üòé Easy

```

4. When the user presses a button, the bot:
- calls the SRS scheduler to compute the next interval and `next_review_at`;
- updates the corresponding `srs_items` row.

Message format with spoilers and inline buttons follows the original workshop specification. :contentReference[oaicite:4]{index=4}

## Scheduling and settings

User settings (in `profiles` or a separate settings table) may include:

- `timezone`,
- preferred delivery window (e.g. 09:00‚Äì21:00),
- `daily_word_limit`.

The bot should respect these settings when selecting which items to send.

If the user does not answer a message before the next run:

- the word is rescheduled (e.g. `next_review_at` moves into the future by a small amount),
- the old message may be deleted or left as is (configurable).

## Additional features (optional)

- Pause/resume learning for a user.
- Stats command (`/stats`) showing:
- total items,
- items due today,
- success rate.
- Commands for managing vocabulary:
- add/remove words manually,
- list active words.
```

---

### `docs/spaced-repetition.md`

````md
# Spaced Repetition (SRS) Algorithm

The bot uses a simple 4-level difficulty SRS algorithm inspired by Anki. :contentReference[oaicite:5]{index=5}

## Difficulty levels and base intervals

For each review, the user picks one of 4 options:

- üò∞ Hard    ‚Üí repeat after 10 minutes
- ü§î Normal  ‚Üí repeat after 1 day
- üëç Good    ‚Üí repeat after 3 days
- üòé Easy    ‚Üí repeat after 7 days

Internally we store intervals in minutes:

- Hard: `10`
- Normal: `1 * 24 * 60`
- Good: `3 * 24 * 60`
- Easy: `7 * 24 * 60`

## Data model

(See `docs/data-model.md` for table details.)

Relevant fields in `srs_items`:

- `user_id`, `word_id`
- `next_review_at` ‚Äî when the item is due next
- `last_review_at` ‚Äî when it was reviewed last time
- `interval_minutes` ‚Äî current interval
- `difficulty_last` ‚Äî last chosen difficulty
- `review_count` ‚Äî how many times the user has reviewed this word

## Scheduling rules

Initial creation:

- When a word becomes `unknown` in the quiz, we either:
  - create a new SRS item with:
    - `interval_minutes = 10`,
    - `next_review_at = now() + interval_minutes`,
  - or reuse existing item if it already exists.

Review update (simplified):

```ts
function scheduleNextReview({
  now,
  previousIntervalMinutes,
  previousReviewCount,
  difficulty,
}: {
  now: Date;
  previousIntervalMinutes: number;
  previousReviewCount: number;
  difficulty: 'hard' | 'normal' | 'good' | 'easy';
}): {
  nextIntervalMinutes: number;
  nextReviewAt: Date;
} {
  const base = {
    hard: 10,
    normal: 1 * 24 * 60,
    good: 3 * 24 * 60,
    easy: 7 * 24 * 60,
  }[difficulty];

  // Simple rule: multiply base by a factor that grows with review_count.
  const factor = Math.max(1, previousReviewCount);
  const nextIntervalMinutes = base * factor;

  return {
    nextIntervalMinutes,
    nextReviewAt: addMinutes(now, nextIntervalMinutes),
  };
}
````

This logic lives in `packages/domain/srs.ts` and is tested with unit tests.

## Extensibility

To change or extend the algorithm:

* Update the domain function in `packages/domain/srs.ts`.
* Update tests to reflect the new behaviour.
* No changes are required in the Telegram bot except for using new fields if needed.

Examples of possible extensions:

* Different schedules per user level (A1 vs B2).
* Extra difficulty options.
* Tag-based priorities (e.g. focus on business vocabulary).

````

---

### `docs/data-model.md`

```md
# Data Model

This document describes the main tables in the Supabase (Postgres) database.

## Users

- `auth.users` ‚Äî managed by Supabase Auth.
- `profiles`
  - `id` (uuid, PK, references `auth.users.id`)
  - `created_at` (timestamptz)
  - `telegram_chat_id` (text, unique, nullable)
  - `timezone` (text)
  - `daily_word_limit` (int)

## Words

- `words`
  - `id` (uuid, PK)
  - `text_en` (text)
  - `level` (text, optional)
  - `example_en` (text, optional)
  - `example_ru` (text, optional)
  - `tags` (text[])
  - `extra` (jsonb) ‚Äî reserved for future properties

- `word_pronunciations`
  - `id` (uuid, PK)
  - `word_id` (uuid, FK ‚Üí `words.id`)
  - `locale` (text)
  - `ipa` (text, optional)
  - `audio_url` (text, optional)
  - `source` (text, optional)

## User word state (quiz)

- `user_word_state`
  - `user_id` (uuid, FK ‚Üí `profiles.id`)
  - `word_id` (uuid, FK ‚Üí `words.id`)
  - `status` (`word_status` enum: `unknown`, `learning`, `known`)
  - `last_seen_at` (timestamptz)
  - `seen_count` (int)

PK: (`user_id`, `word_id`).

## Spaced repetition

- `srs_items`
  - `user_id` (uuid, FK ‚Üí `profiles.id`)
  - `word_id` (uuid, FK ‚Üí `words.id`)
  - `next_review_at` (timestamptz)
  - `last_review_at` (timestamptz, nullable)
  - `interval_minutes` (int)
  - `difficulty_last` (`srs_difficulty` enum)
  - `review_count` (int)
  - `active` (boolean)

PK: (`user_id`, `word_id`).

## Optional: quiz sessions

If needed, we can add:

- `quiz_runs`
- `quiz_answers`

See comments in `docs/overview.md` for how they would be used.
````

---

### `CONTRIBUTING.md`

````md
# Contributing

## Getting started

1. Install dependencies:

   ```bash
   pnpm install
````

2. Configure Supabase:

   * create a Supabase project,
   * run migrations from `supabase/migrations`,
   * set environment variables (`SUPABASE_URL`, `SUPABASE_KEY`, etc.).

3. Run the web app:

   ```bash
   pnpm dev:web
   ```

4. Run the Telegram bot:

   ```bash
   pnpm dev:bot
   ```

## Code style

* TypeScript only.
* Keep business logic in `packages/domain`.
* Keep data access logic in `packages/infra-supabase`.
* Use ESLint + Prettier (configured in the repo).

Before pushing:

```bash
pnpm check
```

## Working with issues

1. Pick an issue and read the linked docs in `docs/`.
2. Leave a short **plan** as a comment.
3. Implement one or two steps from the plan in a **small PR**.
4. Make sure:

   * tests pass,
   * the PR template is fully filled.

## Pull requests

* Use the existing PR template.
* Keep PRs small and focused (ideally ‚â§ 300‚Äì400 lines changed).
* Describe:

  * **What** you changed,
  * **Why** you changed it,
  * **How** you implemented it (short summary of the approach).

If you are an AI agent, please also follow `AGENTS.md`.

````

---

### `.github/pull_request_template.md`

```md
## What

<!-- Short summary of the change. -->

## Why

<!-- Why is this change needed? Reference the issue and explain the reasoning. -->

## How

<!-- High-level explanation of the approach, important design decisions, and trade-offs. -->

## Screenshots / Bot messages (if applicable)

<!-- Add screenshots or example bot messages to illustrate the change. -->

## Checklist

- [ ] I ran `pnpm check` (lint, typecheck, tests).
- [ ] I updated or added tests for the new behaviour.
- [ ] I updated relevant docs (`docs/*.md`), if needed.
- [ ] Changes are reasonably small and focused.
````

---